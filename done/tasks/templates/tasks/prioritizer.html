{% extends 'base.html' %}
{% block data-wf %}data-wf-page="653fc2444491a35371971509" data-wf-site="652482ea837db348b1939c93"{% endblock data-wf %}
{% block title %}Priorizer{% endblock title %}
{% load widget_tweaks %}
{% block content %}

  <div class="main-section">
    <div class="form-block-header w-form">
      <form id="wf-form-selector" name="wf-form-selector" data-name="selector" method="post" class="form-2" data-wf-page-id="653fc2444491a35371971509" data-wf-element-id="89f1164f-914e-c1bf-ad36-09a1e20dd3f5">
        <div class="nto-header-div medium">
          <div class="nto-hrd-div centered">
            <div class="nto-hdr">
              <div class="done-logo-small">DONE</div>
              <div class="hdr-2">Priorizer</div>
            </div>
          </div>
          <div class="nto-inpt-slct-div horizontal single-line"><label data-w-id="89f1164f-914e-c1bf-ad36-09a1e20dd40a" class="radio-btn-field w-radio"><input type="radio" id="project-2" name="input-type" value="project" data-name="input type" class="w-form-formradioinput radio-btn w-radio-input"><span class="menu-txt w-form-label" for="project-2">Projects</span></label><label data-w-id="89f1164f-914e-c1bf-ad36-09a1e20dd40e" class="radio-btn-field w-radio"><input type="radio" id="not-actionable" name="input-type" value="not actionable" data-name="input type" class="w-form-formradioinput radio-btn w-radio-input"><span class="radio-button-label w-form-label" for="not-actionable">Tasks</span></label></div>
        </div>
      </form>
      <div class="w-form-done">
        <div>Thank you! Your submission has been received!</div>
      </div>
      <div class="w-form-fail">
        <div>Oops! Something went wrong while submitting the form.</div>
      </div>
    </div>
    <div data-w-id="0ad156d8-e1d7-1bb0-dce7-4d0941c0a634" class="hint-block">
      <div class="project-name">choose Projects of Task table</div>
    </div>
    <div data-w-id="e5de06c0-062f-37c2-782f-937d60c8eb3a" class="tbl-frame">
      <table class="task-table_component">
        <thead class="task-table_head">
          <tr class="task-table_row">
            <th class="tbl-hdr" data-sort="completion">Completion</th>
            <th class="tbl-hdr" data-sort="compound">Compound <br>Priority</th>
            <th class="tbl-hdr" data-sort="priority">Priority</th>
            <th class="tbl-hdr" data-sort="name">Name</th>
            <th class="tbl-hdr" data-sort="effort">Effort</th>
            <th class="tbl-hdr" data-sort="context">Context</th>
            <th class="tbl-hdr" data-sort="deadline">Deadline</th>
            <th class="tbl-hdr" data-sort="assignee">Assignee</th>
          </tr>
        </thead>

          {% for task in tasks %}
          <tr>
              <td class="editable tbl-cell centered" data-id="{{ task.id }}" data-type="complete">{{ task.complete }}</td>
              <td class="editable tbl-cell centered" data-id="{{ task.id }}" data-type="compound">compnd</td>
              <td class="editable tbl-cell centered" data-id="{{ task.id }}" data-type="priority">{{ task.priority }}</td>
              <td class="editable tbl-cell" data-id="{{ task.id }}" data-type="name">{{ task.name }}</td>
              <td class="editable tbl-cell centered" data-id="{{ task.id }}" data-type="effort">{{ task.effort }}</td>
              <td class="editable tbl-cell centered" data-id="{{ task.id }}" data-type="context">{{ task.contex }}</td>
              <td class="editable tbl-cell centered" data-id="{{ task.id }}" data-type="deadline">{{ task.deadline }}</td>
              <td class="editable tbl-cell centered" data-id="{{ task.id }}" data-type="assignee">{{ task.assignee }}</td>
          </tr>
          {% endfor %}
          {% comment %} <tr class="task-table_row">
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
          </tr>
          <tr class="task-table_row">
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
          </tr>
          <tr class="task-table_row">
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
          </tr>
          <tr class="task-table_row">
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
          </tr>
          <tr class="task-table_row">
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
          </tr>
          <tr class="task-table_row">
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
          </tr> {% endcomment %}
        </tbody>
      </table>
    </div>
    <div data-w-id="702bb6ac-73de-582a-b6b8-eae4ff24e7c1" class="tbl-frame">
      <table class="task-table_component">
        <thead class="task-table_head">
          <tr class="task-table_row">
            <th class="tbl-hdr" data-sort=">Completion</th>
            <th class="tbl-hdr" data-sort=">Priority</th>
            <th class="tbl-hdr" data-sort=">Name</th>
            <th class="tbl-hdr" data-sort=">Effort</th>
            <th class="tbl-hdr" data-sort=">Context</th>
            <th class="tbl-hdr" data-sort=">Deadline</th>
            <th class="tbl-hdr" data-sort=">Assignee</th>
          </tr>
        </thead>
        <tbody class="task-table_body">
          <tr class="task-table_row">
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
          </tr>
          <tr class="task-table_row">
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
          </tr>
          <tr class="task-table_row">
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
          </tr>
          <tr class="task-table_row">
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
          </tr>
          <tr class="task-table_row">
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
          </tr>
          <tr class="task-table_row">
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
          </tr>
          <tr class="task-table_row">
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
            <td class="tbl-cell centered">Cell</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="frame-427318914">
      <div class="frame-427318912">
        <div class="text-7">Close</div>
      </div>
    </div>
  </div>
  {% endblock content %}

  {% block custom_js %}
  <script>
    $(document).ready(function() {
        // Double-click to edit
        $(document).on("dblclick", ".editable", function() {
            var value = $(this).text();
            var data_type = $(this).data("type");
            var input_type = "text";
            if (data_type === "created_at") {
                input_type = "datetime-local";
            } else if (data_type === "priority") {
                var taskId = $(this).data("id");
                var formHtml = '<form id="priority-form-' + taskId + '" class="input-data form-control">';
                formHtml += '{% csrf_token %}{{ task_form.priority }}';
                formHtml += '<input type="submit" style="display: none;"></form>';
                $(this).html(formHtml);
                $(this).removeClass("editable");

                // Handle form submission for priority change
                $("#priority-form-" + taskId).submit(function(event) {
                    event.preventDefault();
                    var newPriority = $("#id_priority").val();
                    sendToServer(taskId, newPriority, data_type);
                });

                return;
            }
            var input = "<input type='" + input_type + "' class='input-data form-control' value='" + value + "'>";
            $(this).html(input);
            $(this).removeClass("editable");
        });

        // Handle editing blur and keypress events here...
        $(document).on("blur",".input-data",function(){
          var value=$(this).val();
          var td=$(this).parent("td");
          $(this).remove();
          td.html(value);
          td.addClass("editable");
          var type=td.data("type");
          sendToServer(td.data("id"),value,type);
        });
        $(document).on("keypress",".input-data",function(e){
            var key=e.which;
            if(key==13){
                var value=$(this).val();
                var td=$(this).parent("td");
                $(this).remove();
                td.html(value);
                td.addClass("editable");
                var type=td.data("type");
                sendToServer(td.data("id"),value,type);
            }
        });

        // Sorting
        $('.tbl-hdr').on('click', function() {
            var column = $(this).data('sort');
            var direction = $(this).hasClass('asc') ? -1 : 1;
            var $table = $(this).closest('table');
            var $rows = $table.find('tbody > tr');

            $rows.sort(function(a, b) {
                var aValue = $(a).find('td[data-type="' + column + '"]').text();
                var bValue = $(b).find('td[data-type="' + column + '"]').text();
                if ($.isNumeric(aValue) && $.isNumeric(bValue)) {
                    return direction * (parseFloat(aValue) - parseFloat(bValue));
                } else {
                    return direction * aValue.localeCompare(bValue);
                }
            });

            $table.find('th').removeClass('asc').removeClass('desc');
            $(this).addClass(direction === 1 ? 'asc' : 'desc');

            $table.find('tbody').empty().append($rows);

            // Rebind double-click events for editing after sorting
            bindDoubleClickEditing();
        });

        function bindDoubleClickEditing() {
            $(document).on("dblclick", ".editable", function() {
                var value = $(this).text();
                var data_type = $(this).data("type");
                var input_type = "text";
                if (data_type === "created_at") {
                    input_type = "datetime-local";
                } else if (data_type === "priority") {
                    var taskId = $(this).data("id");
                    var formHtml = '<form id="priority-form-' + taskId + '" class="input-data form-control">';
                    formHtml += '{% csrf_token %}{{ task_form.priority }}';
                    formHtml += '<input type="submit" style="display: none;"></form>';
                    $(this).html(formHtml);
                    $(this).removeClass("editable");

                    // Handle form submission for priority change
                    $("#priority-form-" + taskId).submit(function(event) {
                        event.preventDefault();
                        var newPriority = $("#id_priority").val();
                        sendToServer(taskId, newPriority, data_type);
                    });

                    return;
                }
                var input = "<input type='" + input_type + "' class='input-data form-control' value='" + value + "'>";
                $(this).html(input);
                $(this).removeClass("editable");
            });

            // Handle editing blur and keypress events here...
            $(document).on("blur",".input-data",function(){
              var value=$(this).val();
              var td=$(this).parent("td");
              $(this).remove();
              td.html(value);
              td.addClass("editable");
              var type=td.data("type");
              sendToServer(td.data("id"),value,type);
            });
            $(document).on("keypress",".input-data",function(e){
                var key=e.which;
                if(key==13){
                    var value=$(this).val();
                    var td=$(this).parent("td");
                    $(this).remove();
                    td.html(value);
                    td.addClass("editable");
                    var type=td.data("type");
                    sendToServer(td.data("id"),value,type);
                }
            });
        }

        // Initial binding of double-click editing
        bindDoubleClickEditing();
    });
</script>


{% endblock custom_js %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>